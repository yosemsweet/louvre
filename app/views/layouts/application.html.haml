!!!
%html
  %head
    %title= @title || "Loorp! v0"
    = render :partial => "layouts/stylesheets"        
    = render :partial => "layouts/javascripts"
    = csrf_meta_tag
    = yield :opengraph_meta_tags
  %body
    :javascript
      // Common javascript request variables
      var request = {
        root_url : "#{root_url}",
        user_id : #{current_user ? current_user.id : 0},
        canvas_id : #{@canvas ? @canvas.id : 0},
        page_id : #{@page ? @page.id : 0}
      };
      
    #fb-root
      :javascript
        FBCallbacks = new Array();
        FB.init({appId: '196297497094752', status: true, cookie: true, xfbml: true});
        this.callbacks = new Object();
        this.callbacks.push = function(func){func();};
        for(var i=0; i < FBCallbacks.length; i++){
          FBCallbacks[i]();
        }
        FBCallbacks = this.callbacks;

    #header
      .container
        #user-nav
          - if current_user
            == Logged in as #{current_user.name}
            |
            = link_to "Home", root_url
            |
            = link_to "Hud", hud_user_path(current_user), :id => "show_hud"
            |
            = link_to "Log out", logout_path
          - else
            = login_link :text => "Log in with Facebook"
        %h1#logo
          -if @title 
            = link_to_unless_current @title, canvas_path(@canvas) 
          -else 
            loorp
          
    #body
      
      .container
      
        #breadcrumbs{:style => "border-bottom: 1px dotted; padding: 0 0 5px 5px"}
          = render_breadcrumbs
      
        #flash.span-24{:style => "display:none; position: absolute"}
          -flash.each do |type, value|
            .flash{ :class => type.to_s }
              = value
    
        = yield 
    
    - if current_user
      #hud
        %a#hide_hud{:href => "#"} Hide
        #hud_content
        
    - if current_user
      :javascript
        $("#hud").hide();
        
        var hud_width = $("#hud").outerWidth();
        $("#hud").css("top", $("#header").outerHeight() + "px");
        $("#hud").css("right", -1 * hud_width + "px");
        
        var reload_hud = function(){
          $("#hud_content").load("#{hud_user_path(current_user)}");  
        }
        
        var toggle_hud = function(){
          
          if(parseInt($("#hud").css("right")) < 0){
            $("#hud").toggle();
            $("#hud").animate({
              right: "+=" + hud_width
            }, 300);
          } else {
            $("#hud").animate({
              right: "-=" + hud_width
            }, 300, function(){
              $("#hud").toggle();
            });
          }
          
          //$("#hud").toggle(300);
        }        
        
        reload_hud();        
        
        $("#show_hud").click(function(event){
          event.preventDefault();
          toggle_hud();
        });  
        
        $("#hide_hud").click(function(event){
          event.preventDefault();
          toggle_hud();
        });
          
    :javascript
      $(function() {
              
         $('#flash').delay(500).fadeIn('normal', function() {
            $(this).delay(2500).fadeOut('slow');
         });
      });
      
         
