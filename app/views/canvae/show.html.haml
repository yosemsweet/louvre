- content_for(:opengraph_meta_tags, opengraph_meta_tags_for(@canvas, :url => canvas_url(@canvas), :site_name => @canvas.name))
- content_for :stylesheets do
  = stylesheet_link_tag 'compiled/canvas.css', :media => 'screen, projection'
- content_for :javascripts do
  = javascript_include_tag 'canvas_show'  
-if can?(:update, @canvas)
  - content_for :javascripts do
    = javascript_include_tag 'canvas_edit.js', :media => 'screen, projection'

= render 'shared/welcome'

.mini_dashboard
  Creator:
  = @canvas.creator
  - if can?(:update, @canvas)
    |
    = link_to @canvas.members.length.to_s + ' Members', members_canvas_path(@canvas)
  - if can?(:update, CanvasApplicant.new(:canvas_id => @canvas.id))
    |
    = link_to @canvas.applicants.length.to_s + ' Applicants', applicants_canvas_path(@canvas)

- if can?(:apply, @canvas)
  .apply-join
    - if @canvas.closed?
      #apply.button
        Apply Now
      #apply-form
        %form#applicant_form
          %div Please let us know why you would like to join this community
          %textarea#note{:value => current_user.id, :name => "note", :style => "height:125px"}
    - else
      #join.button
        Join Now
#canvas_name_text= @canvas.name

-if can?(:update, @canvas)
  = form_for @canvas do |f|
    .field
      = f.text_field :name
      = hint_for(@canvas, @current_user, "canvas")
        
      .input_note#canvas_name_input_note

- if can?(:create, Widget.new(:canvas => @canvas))
  %br
  #toolbar
    %a.add_widget.tab{:href => "#", :data => {:content_type => "text_content", :canvas_id => @canvas.id}} Add Text
    %a.add_widget.tab{:href => "#", :data => {:content_type => "image_content", :canvas_id => @canvas.id}} Add Image
    %a.add_widget.tab{:href => "#", :data => {:content_type => "link_content", :canvas_id => @canvas.id}} Add Link
    %a.add_widget.tab{:href => "#", :data => {:content_type => "question_content", :canvas_id => @canvas.id}} Add Question
  
  %ul#inline_form
    - @new_widgets.each do |t, widget|
      %div{:style => "display:none;"}
        = render :partial => "widgets/canvas_feed", :object => widget, :as => :widget
= hint_for(@canvas, current_user, "widget")
\
%ul#feed
  //= render :collection => @canvas.widgets, :partial => "widgets/canvas_feed", :as => :widget
  = render :collection => Widget.for_canvas(@canvas.id,1), :partial => "widgets/canvas_feed", :as => :widget

  
#pages
  
  - if can? :create, Page.new(:canvas => @canvas)
    #toolbar
      %a.add_page.tab{:href => new_canvas_page_path(@canvas), :data => {:content_type => "page", :canvas_id => @canvas.id}} New Page
    = hint_for(@canvas, current_user, "page")
  %ul.page_list
  - @canvas.pages.each do |page|
    %li.page_icon_grid
      %a{:href => canvas_page_path(@canvas, page)}
        %img{:src => "/images/page.png"}
        .page_icon_title= page.title

- if can?(:create, Widget.new(:canvas => @canvas))
  %hr

  #inputs

    .bookmarklet
      Install Bookmarklet by dragging to your
      %a#bookmarklet{:href => "#"} 
        = "add to #{@canvas.name}"
      %a.link-help-bookmarklet{:href => "#"} ?
      .toggle-link-help-bookmarklet.info{:style => "display:none"}
        %iframe{:width=>"425", :height=>"349", :src => "http://www.youtube.com/embed/QrwevUN0KdQ"}

    .add-by-email
      Easily add content to the feed by sending an email to this address:
      = link_to "#{@canvas.id}@feed.loorp.com", "mailto:#{@canvas.id}@feed.loorp.com"
      
      %a.link-help-email{:href => "#"} ?
      .toggle-link-help-email.info{:style => "display:none"}
        Note that you must register your sending email address before adding content by email. Do this on your
        = link_to "account settings page", edit_user_path

    :javascript
      $("a#bookmarklet")
        .mousedown(function(){
          // Track the bookmarklet install.
          mpq.push(['track','install_bookmark']);
        })
        .attr("href", "#{raw(bookmarklet(@canvas, current_user))}");
