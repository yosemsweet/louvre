:javascript
  // Initialize mixpanel.
  var mpq = [];
  mpq.push(["init", "#{MIXPANEL_CONFIG[:token]}"]);
  (function() {
    var mp = document.createElement("script"); 
    mp.type = "text/javascript"; 
    mp.async = true;
    mp.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + "//api.mixpanel.com/site_media/js/api/mixpanel.js";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(mp, s);
  })();
  
-if current_user
  :javascript
    $(function(){
      mpq.push(["name_tag","#{current_user.name}"]);
      mpq.push(["identify","#{current_user.id}"]);
    });
-else
  :javascript
    $(function(){
      mpq.push(["identify"]);
    });
