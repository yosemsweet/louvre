- if current_user
  = form_for widget, {:html => {:style => "display:none;", :class => "edit_widget"}} do |f| 
    .field
      = f.label :tag_ids, "Tags"
      = f.text_field :tag_ids, {"data-pre" => widget.tags.map(&:attributes).to_json, :class => "widget_tag_ids"}
    - case widget.content_type  
    - when 'text_content'
      .field
        = f.text_area :text, {:id => "widget_ckeditor_#{widget.id || 0}"}
    - when 'image_content'
      .field
        = f.label 'image url'
        = f.text_field :image
      .field
        = f.label 'image alt text'
        = f.text_field :alt_text
    - when 'link_content'
      .field
        = f.label 'title'
        = f.text_field :title
      .field
        = f.label 'link'
        = f.text_field :link
      .field
        = f.text_area :text
    - when 'question_content'
      .field
        = f.label 'question'
        %br
        = f.text_area :question
         
    %input{:type => "hidden", :name => "widget[content_type]", :value => "#{widget.content_type}"}
    %input{:type => "hidden", :name => "widget[creator_id]", :value => "#{current_user.id}"}

    - if widget.page
      %input{:type => "hidden", :name => "page_id", :value => "#{widget.page.id}"}
    - else
      %input{:type => "hidden", :name => "canvas_id", :value => "#{widget.canvas.id}"}
      
    .actions
      = f.submit 'Save'
      
    - if widget.answer
      .field
        = f.label 'answer'
        %br
          %ul{:style => "list-style: none;"}
            - widget.answers.each do |answer|
              %li
                %a.delete_answer{:href => "#", :data => {:widget_id => widget.id} } X 
                = answer["commenter"]
                %em==(#{time_ago_in_words(answer["comment_date"])} ago)
                \:
                = answer["message"]
                
